import React, { useState, useReducer, useCallback } from 'react';
import { Menu, X, Home, Briefcase, Mail, CheckCircle } from 'lucide-react';

// --- Configuration & Static Data ---

const companyName = "Innovatech Solutions";
const servicesData = [
  { id: 1, title: "Modern Web Development", description: "Building fast, secure, and scalable web applications using React, Next.js, and modern APIs.", icon: <Briefcase className="w-6 h-6 text-indigo-500" /> },
  { id: 2, title: "Cloud Infrastructure", description: "Implementing robust, cost-effective, and highly available cloud solutions on AWS, Azure, or GCP.", icon: <Home className="w-6 h-6 text-indigo-500" /> },
  { id: 3, title: "UX/UI Design & Strategy", description: "Crafting intuitive and engaging user experiences with a focus on accessibility and conversion optimization.", icon: <Mail className="w-6 h-6 text-indigo-500" /> },
  { id: 4, title: "Digital Transformation", description: "Guiding businesses through the adoption of new technologies and streamlining existing processes.", icon: <CheckCircle className="w-6 h-6 text-indigo-500" /> },
];

const initialFormState = {
  name: '',
  email: '',
  message: '',
  isSubmitting: false,
  submissionSuccess: false,
  error: null,
};

// --- State Management with useReducer for Contact Form ---

const formReducer = (state, action) => {
  switch (action.type) {
    case 'CHANGE':
      return { ...state, [action.field]: action.value, error: null };
    case 'SUBMIT_START':
      return { ...state, isSubmitting: true, error: null, submissionSuccess: false };
    case 'SUBMIT_SUCCESS':
      // Clear form inputs but keep submission success true
      return { ...initialFormState, submissionSuccess: true };
    case 'SUBMIT_ERROR':
      return { ...state, isSubmitting: false, error: action.payload };
    case 'RESET':
      return initialFormState;
    default:
      return state;
  }
};

// --- Components ---

const Header = ({ currentPage, onNavigate }) => {
  const [isOpen, setIsOpen] = useState(false);

  const navItems = [
    { name: 'Home', path: 'home', icon: Home },
    { name: 'Services', path: 'services', icon: Briefcase },
    { name: 'Contact', path: 'contact', icon: Mail },
  ];

  const handleNavClick = (path) => {
    onNavigate(path);
    setIsOpen(false);
  };

  return (
    <header className="sticky top-0 z-20 bg-white shadow-lg backdrop-blur-md bg-opacity-95">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <h1 className="text-2xl font-extrabold text-indigo-700 tracking-tight">
          {companyName}
        </h1>

        {/* Desktop Navigation */}
        <nav className="hidden md:flex space-x-6" aria-label="Main Navigation">
          {navItems.map((item) => (
            <button
              key={item.path}
              onClick={() => handleNavClick(item.path)}
              className={`flex items-center space-x-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 ${
                currentPage === item.path
                  ? 'bg-indigo-500 text-white shadow-md'
                  : 'text-gray-600 hover:bg-gray-100 hover:text-indigo-600'
              }`}
              aria-current={currentPage === item.path ? 'page' : undefined}
            >
              <item.icon className="w-4 h-4" />
              <span>{item.name}</span>
            </button>
          ))}
        </nav>

        {/* Mobile Menu Button */}
        <button
          className="md:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
          onClick={() => setIsOpen(!isOpen)}
          aria-expanded={isOpen}
          aria-controls="mobile-menu"
        >
          {isOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
        </button>
      </div>

      {/* Mobile Menu Panel */}
      {isOpen && (
        <div id="mobile-menu" className="md:hidden border-t border-gray-100">
          <nav className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
            {navItems.map((item) => (
              <button
                key={item.path}
                onClick={() => handleNavClick(item.path)}
                className={`w-full text-left flex items-center space-x-2 px-3 py-2 rounded-md text-base font-medium transition-colors ${
                  currentPage === item.path
                    ? 'bg-indigo-500 text-white'
                    : 'text-gray-700 hover:bg-indigo-50 hover:text-indigo-700'
                }`}
                aria-current={currentPage === item.path ? 'page' : undefined}
              >
                <item.icon className="w-5 h-5" />
                <span>{item.name}</span>
              </button>
            ))}
          </nav>
        </div>
      )}
    </header>
  );
};

const Footer = () => (
  <footer className="bg-gray-800 text-white mt-12 py-8">
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p className="text-sm">
        &copy; {new Date().getFullYear()} {companyName}. All rights reserved.
      </p>
      <p className="text-xs text-gray-400 mt-2">
        Built with React and Tailwind CSS for modern web standards and accessibility.
      </p>
    </div>
  </footer>
);

// --- Page Components ---

const HomePage = () => (
  <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <section className="text-center py-16 bg-gradient-to-r from-indigo-50 to-white rounded-xl shadow-xl">
      <h2 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-gray-900 mb-4 tracking-tight">
        Future-Proof Your Business. Today.
      </h2>
      <p className="text-lg sm:text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
        We deliver advanced digital solutions, blending cutting-edge technology with intuitive design to drive growth and efficiency.
      </p>
      <button className="px-8 py-3 text-lg font-semibold rounded-full bg-indigo-600 text-white hover:bg-indigo-700 transition duration-300 shadow-lg transform hover:scale-105" onClick={() => console.log('Navigate to Services')}>
        Explore Our Solutions
      </button>
    </section>

    <section className="mt-16">
      <h3 className="text-3xl font-bold text-gray-900 mb-6 text-center">Why Choose Us?</h3>
      <div className="flex flex-col md:flex-row justify-around space-y-8 md:space-y-0 md:space-x-8">
        {[
          { title: "Performance", detail: "Lightning-fast, optimized code.", icon: 'âš¡' },
          { title: "Scalability", detail: "Ready for growth, built on flexible architecture.", icon: 'ðŸ“ˆ' },
          { title: "Accessibility", detail: "Web standards compliant for all users.", icon: 'â™¿' },
        ].map((item, index) => (
          <div key={index} className="flex flex-col items-center p-6 bg-white rounded-xl shadow-md transition duration-300 hover:shadow-xl w-full md:w-1/3">
            <span className="text-4xl mb-3">{item.icon}</span>
            <h4 className="text-xl font-semibold text-indigo-600 mb-2">{item.title}</h4>
            <p className="text-gray-600 text-center">{item.detail}</p>
          </div>
        ))}
      </div>
    </section>
  </main>
);

const ServicesPage = () => (
  <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h2 className="text-4xl font-bold text-gray-900 mb-4 text-center">Our Core Services</h2>
    <p className="text-xl text-gray-600 mb-12 text-center max-w-3xl mx-auto">
      We combine expertise in React, ES6+, and modern CSS frameworks to deliver digital products that are robust, beautiful, and highly performant.
    </p>

    {/* Complex Layout using CSS Grid (Responsive) */}
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
      {servicesData.map((service) => (
        <div
          key={service.id}
          className="bg-white p-6 rounded-xl shadow-lg border border-gray-100 transition duration-300 hover:shadow-xl transform hover:-translate-y-1 flex flex-col"
        >
          <div className="flex items-center mb-4">
            {service.icon}
            <h3 className="ml-3 text-xl font-semibold text-gray-900">{service.title}</h3>
          </div>
          <p className="text-gray-600 flex-grow">{service.description}</p>
          <button className="mt-4 text-indigo-600 font-medium hover:text-indigo-800 self-start">
            Learn More &rarr;
          </button>
        </div>
      ))}
    </div>
  </main>
);

const ContactPage = () => {
  const [state, dispatch] = useReducer(formReducer, initialFormState);

  const handleChange = useCallback((e) => {
    dispatch({ type: 'CHANGE', field: e.target.name, value: e.target.value });
  }, []);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!state.name || !state.email || !state.message) {
      dispatch({ type: 'SUBMIT_ERROR', payload: 'Please fill out all required fields.' });
      return;
    }

    dispatch({ type: 'SUBMIT_START' });

    // --- Modern JS Practice: Simulate API Call with async/await ---
    const simulateApiCall = new Promise((resolve) => {
      setTimeout(() => {
        resolve({ status: 'success' }); // Mocking a successful submission
      }, 1500);
    });

    simulateApiCall
      .then(() => {
        // useReducer updates state to initialFormState and sets submissionSuccess to true
        dispatch({ type: 'SUBMIT_SUCCESS' });
      })
      .catch((error) => {
        dispatch({ type: 'SUBMIT_ERROR', payload: 'Failed to send message. Please try again later.' });
        console.error("Submission Error:", error);
      });
  };

  return (
    <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-12 max-w-4xl">
      <h2 className="text-4xl font-bold text-gray-900 mb-4 text-center">Get in Touch</h2>
      <p className="text-xl text-gray-600 mb-8 text-center">
        We're ready to start building your next success story.
      </p>

      <div className="bg-white p-8 rounded-xl shadow-2xl border border-indigo-100">
        {state.submissionSuccess ? (
          <div className="text-center py-10">
            <CheckCircle className="w-16 h-16 mx-auto text-green-500 mb-4" />
            <h3 className="text-2xl font-semibold text-green-700">Message Sent Successfully!</h3>
            <p className="text-gray-600 mt-2">We will get back to you within 24 hours.</p>
            <button
              onClick={() => dispatch({ type: 'RESET' })}
              className="mt-6 px-6 py-2 text-sm font-semibold rounded-full border border-indigo-600 text-indigo-600 hover:bg-indigo-50 transition"
            >
              Send Another Message
            </button>
          </div>
        ) : (
          <form onSubmit={handleSubmit} className="space-y-6" aria-live="polite">
            {/* Error Message */}
            {state.error && (
              <p role="alert" className="p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                {state.error}
              </p>
            )}

            {/* Name Input */}
            <div>
              <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">
                Full Name
              </label>
              <input
                type="text"
                id="name"
                name="name"
                value={state.name}
                onChange={handleChange}
                required
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"
              />
            </div>

            {/* Email Input */}
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
                Email Address
              </label>
              <input
                type="email"
                id="email"
                name="email"
                value={state.email}
                onChange={handleChange}
                required
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"
              />
            </div>

            {/* Message Textarea */}
            <div>
              <label htmlFor="message" className="block text-sm font-medium text-gray-700 mb-1">
                Your Message
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                value={state.message}
                onChange={handleChange}
                required
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"
              />
            </div>

            <button
              type="submit"
              disabled={state.isSubmitting}
              className={`w-full py-3 text-lg font-semibold rounded-lg text-white transition duration-300 shadow-md ${
                state.isSubmitting
                  ? 'bg-indigo-400 cursor-not-allowed'
                  : 'bg-indigo-600 hover:bg-indigo-700 transform hover:scale-[1.01]'
              }`}
            >
              {state.isSubmitting ? (
                <div className="flex items-center justify-center">
                  <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Sending...
                </div>
              ) : (
                'Send Message'
              )}
            </button>
          </form>
        )}
      </div>
    </main>
  );
};

// --- Main App Component ---

const App = () => {
  // Simple State for Multi-Page Routing
  const [currentPage, setCurrentPage] = useState('home');

  const renderPage = () => {
    switch (currentPage) {
      case 'home':
        return <HomePage />;
      case 'services':
        return <ServicesPage />;
      case 'contact':
        return <ContactPage />;
      default:
        return <HomePage />; // Fallback
    }
  };

  return (
    <div className="min-h-screen flex flex-col bg-gray-50 font-sans">
      <Header currentPage={currentPage} onNavigate={setCurrentPage} />
      <div className="flex-grow">
        {renderPage()}
      </div>
      <Footer />
    </div>
  );
};

export default App;
